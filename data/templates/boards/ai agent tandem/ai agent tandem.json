{
    "name": "{{{name}}}",
    "cards": [
        {
            "key": "action_1760800582118",
            "width": 4,
            "height": 20,
            "icon": "globe",
            "name": "agent_input",
            "description": "A job queue with a list of pending jobs and a current job",
            "type": "action",
            "editorOptions": {},
            "displayResponse": true,
            "params": {
                "item": "",
                "action": "action to perform in the queue: push, pop, clear",
                "response": ""
            },
            "configParams": {
                "item": {
                    "visible": true,
                    "defaultValue": "",
                    "type": "string"
                },
                "action": {
                    "visible": true,
                    "defaultValue": "",
                    "type": "string"
                },
                "response": {
                    "visible": true,
                    "defaultValue": "",
                    "type": "string"
                }
            },
            "presets": {
                "reply": {
                    "description": "Sends a reply to the current job and makes the next item (if any) the current job. The reply should be specified in the response param",
                    "configParams": {
                        "action": {
                            "visible": false,
                            "defaultValue": "reply"
                        },
                        "item": {
                            "visible": false
                        },
                        "response": {
                            "visible": true
                        }
                    }
                },
                "skip": {
                    "description": "Skips the current job. Do not use unless you know what you are doing.",
                    "configParams": {
                        "action": {
                            "defaultValue": "skip"
                        }
                    }
                },
                "reset": {
                    "description": "resets the queue state to empty and skip curret job",
                    "configParams": {
                        "action": {
                            "defaultValue": "clear"
                        }
                    }
                },
                "remove": {
                    "description": "remove the element with the given index from the job queue",
                    "configParams": {
                        "action": {
                            "defaultValue": "remove"
                        },
                        "item": {
                            "visible": true,
                            "defaultValue": 0,
                            "type": "number"
                        }
                    }
                },
                "push": {
                    "params": {
                        "item": "item to push"
                    },
                    "description": "Adds a new job",
                    "configParams": {
                        "action": {
                            "defaultValue": "push"
                        },
                        "item": {
                            "visible": true,
                            "defaultValue": "",
                            "type": "string"
                        }
                    }
                }
            },
            "enableAgentInputMode": true,
            "tokens": {},
            "displayButton": false,
            "manualAPIResponse": true,
            "layer": "agent",
            "rulesCode": "const callCore = () => {\n  setTimeout(() => executeAction({name: \"user_request\", params: {}}), 1)\n}\n\nif (params.action == \"reset\") {\n  return { items: [], current: undefined };\n} else if (params.action == \"skip\") {\n  if(board[name]?.items?.length) {\n    callCore();\n  }\n  return {\n    items: (Array.isArray(board[name]?.items) ? board[name].items : []).slice(\n      1\n    ),\n    current: board[name].items[0],\n  };\n} else if (params.action == \"remove\") {\n  const queue = Array.isArray(board[name]?.items) ? board[name].items : [];\n  const index = parseInt(params.index, 10);\n  return {\n    items: queue.slice(0, index).concat(queue.slice(index + 1)),\n    current: board[name]?.current,\n  };\n} else if (params.action == \"clear\") {\n  return { items: [], current: board[name].current };\n} else if (params.action == \"reply\") {\n  //reply to current job\n  const job = board[name].current;\n  if (!job) {\n    throw \"Unable to send reply: There is not current job to reply to\";\n  }\n  const res = context.boards.getVar(\"job_\" + job.id, true);\n  if (!res) {\n    throw \"Unable to send reply: Empty res object in current job.\";\n  }\n  res.send(params.response);\n  if(board[name]?.items?.length) {\n    callCore();\n  }\n  return {\n    items: (Array.isArray(board[name]?.items) ? board[name].items : []).slice(\n      1\n    ),\n    current: board[name].items[0],\n  };\n} else {\n  const genUID = (l = 16) => {\n    const t = Date.now().toString(36);\n    const r =\n      Math.random().toString(36).slice(2) + Math.random().toString(36).slice(2);\n    let out = \"\";\n    for (let i = 0; i < l; i++)\n      out += (i % 2 ? t : r)[i % (i % 2 ? t.length : r.length)];\n    return out;\n  };\n  const uid = genUID(16);\n  context.boards.setVar(\"job_\" + uid, res);\n  const item = {\n    id: uid,\n    time: new Date().toISOString(),\n    ua: req.get(\"User-Agent\"),\n    params: req.query,\n    path: params.path,\n  };\n\n  if (board[name]?.current) {\n    return {\n      items: (Array.isArray(board[name]?.items)\n        ? board[name].items\n        : []\n      ).concat([item]),\n      current: board[name]?.current,\n    };\n  }\n  callCore();\n  return {\n    items: Array.isArray(board[name]?.items) ? board[name].items : [],\n    current: item,\n  };\n}\n",
            "html": "//@card/react\nfunction Widget(props) {\n  return (\n    <ViewList\n      onReply={(item, response) => execute_action(props.name, {action: 'reply', response: response})}\n      enableReply={true}\n      enableManualPop={true}\n      current={props?.value?.current}\n      emptyMessageProps={{\n        fontSize: \"$6\",\n        fontWeight: \"600\"\n      }}\n      emptyDescription={<YStack>\n        <Paragraph color=\"$color10\" mt={\"$2\"} fontSize={\"$4\"}>\n          <a style={{}} target=\"_new\" href={'/api/agents/v1/'+window?.board?.name+'/'+props?.name+'?message=hello agent'}>{'Open agent link'}</a>\n        </Paragraph>\n      </YStack>  \n      }\n      // emptyMode=\"wait\"\n      emptyMessage=\"Empty agent job queue\"\n      disableManualPush={true}\n      items={props?.value?.items} \n      onPop={(items) => execute_action(props.name, {action: 'skip'})}\n      onClear={(items) => execute_action(props.name, {action: 'reset'})}\n      onPush={(item) => execute_action(props.name, {action: 'push', item})}\n      onDeleteItem={(item, index) => execute_action(props.name, {action: 'remove', index})} \n    />\n  );\n}\n"
        },
        {
            "key": "action_176081905123123",
            "width": 2,
            "height": 7,
            "icon": "rocket",
            "type": "action",
            "name": "reply",
            "displayResponse": false,
            "displayIcon": false,
            "params": {
                "response": "response to send"
            },
            "configParams": {
                "response": {
                    "visible": false,
                    "defaultValue": "board.agent_core",
                    "type": "any"
                }
            },
            "description": "Actions can perform tasks, automate processes, and enhance user interactions. It can also trigger other action-type cards on the board.\n\n  #### Key Features\n  - Run actions from rules.\n  - Chain/trigger other action cards.\n  - Parameterized execution.\n  - Customize parameters.\n  - Customize the card view (UI/render).",
            "autoResponsive": false,
            "displayTitle": false,
            "layer": "agent",
            "rulesCode": "await executeAction({name: \"agent_input\", params: {action:'reply', response: params.response}})\r\nreturn 'ok'",
            "html": "//@card/react\n\nfunction Widget(card) {\n  const value = card.value;\n\n  const content = <YStack f={1}  mt={\"20px\"} ai=\"center\" jc=\"center\" width=\"100%\">\n      {card.icon && card.displayIcon !== false && (\n          <Icon name={card.icon} size={48} color={card.color}/>\n      )}\n      {card.displayResponse !== false && (\n          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? \"N/A\"} />\n      )}\n  </YStack>\n\n  return (\n      <Tinted>\n        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n          <ActionCard data={card}>\n            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}\n          </ActionCard>\n        </ProtoThemeProvider>\n      </Tinted>\n  );\n}\n"
        },
        {
            "key": "action_1761067229271",
            "width": 2,
            "height": 6,
            "icon": "message-square-text",
            "type": "action",
            "name": "reset",
            "description": "Reset the values of a group of cards in the board",
            "params": {
                "included": "array of cards to include, or * for all",
                "excluded": "array of cards to exclude"
            },
            "configParams": {
                "included": {
                    "visible": false,
                    "defaultValue": "[\"*\"]",
                    "type": "array"
                },
                "excluded": {
                    "visible": false,
                    "defaultValue": "[\"agent_input\", \"agent_core\", \"user_request\", \"agent_call\"]",
                    "type": "array"
                }
            },
            "displayResponse": false,
            "buttonLabel": "reset",
            "displayIcon": false,
            "autoResponsive": false,
            "displayTitle": false,
            "layer": "agent",
            "rulesCode": "return await execute_action(\"/api/core/v1/board/cardresetgroup\", userParams)",
            "html": "//@card/react\n\nfunction Widget(card) {\n  const value = card.value;\n\n  const content = <YStack f={1} ai=\"center\" jc=\"center\" width=\"100%\">\n      {card.icon && card.displayIcon !== false && (\n          <Icon name={card.icon} size={48} color={card.color}/>\n      )}\n      {card.displayResponse !== false && (\n          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? \"N/A\"} />\n      )}\n  </YStack>\n\n  return (\n      <Tinted>\n        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n          <ActionCard data={card}>\n            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}\n          </ActionCard>\n        </ProtoThemeProvider>\n      </Tinted>\n  );\n}\n"
        },
        {
            "key": "action_1761187544907",
            "width": 2,
            "height": 7,
            "icon": "rocket",
            "type": "action",
            "name": "user_request",
            "displayResponse": true,
            "displayIcon": false,
            "params": {
                "input": "action input"
            },
            "configParams": {
                "input": {
                    "visible": false,
                    "defaultValue": "board.agent_input.current.params",
                    "type": "any"
                }
            },
            "description": "Actions can perform tasks, automate processes, and enhance user interactions. It can also trigger other action-type cards on the board.\n\n  #### Key Features\n  - Run actions from rules.\n  - Chain/trigger other action cards.\n  - Parameterized execution.\n  - Customize parameters.\n  - Customize the card view (UI/render).",
            "customName": "user_request",
            "layer": "agent",
            "links": [
                {
                    "name": "agent_prepare",
                    "type": "post"
                }
            ],
            "rulesCode": "delete params?.input?.token\r\nreturn params.input",
            "html": "//@card/react\n\nfunction Widget(card) {\n  const value = card.value;\n\n  const content = <YStack f={1} ai=\"center\" jc=\"center\" width=\"100%\">\n      {card.icon && card.displayIcon !== false && (\n          <Icon name={card.icon} size={48} color={card.color}/>\n      )}\n      {card.displayResponse !== false && (\n          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? \"N/A\"} />\n      )}\n  </YStack>\n\n  return (\n      <Tinted>\n        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n          <ActionCard data={card}>\n            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}\n          </ActionCard>\n        </ProtoThemeProvider>\n      </Tinted>\n  );\n}\n"
        },
        {
            "key": "action_1762528976758",
            "width": 3,
            "height": 18,
            "icon": "sparkles",
            "type": "action",
            "name": "agent_prepare",
            "displayResponse": true,
            "params": {
                "prompt": "",
                "actions": "actions visible for the AI to run",
                "values": "values for the AI to see",
                "allow_execution": "Allow this AI action to execute other actions",
                "debug": "returns back the prompt for debugging purposes"
            },
            "configParams": {
                "prompt": {
                    "visible": true,
                    "defaultValue": "board.user_request",
                    "type": "any"
                },
                "actions": {
                    "visible": true,
                    "defaultValue": "[\"\"]",
                    "type": "array"
                },
                "values": {
                    "visible": true,
                    "defaultValue": "[]",
                    "type": "array"
                },
                "allow_execution": {
                    "visible": true,
                    "defaultValue": "true",
                    "type": "boolean"
                },
                "debug": {
                    "visible": true,
                    "defaultValue": "false",
                    "type": "boolean"
                }
            },
            "description": "Execute actions and answer questions using AI.\n\n   #### Key Features\n  - Run actions based on AI.\n  - Chain/trigger other action cards.\n  - Parameterized execution.\n  - Customize parameters.\n  - Customize the card view (UI/render).",
            "displayIcon": false,
            "displayButton": true,
            "displayButtonIcon": true,
            "customName": "agent_prepare",
            "layer": "agent",
            "color": "var(--color7)",
            "theme": "dark",
            "cardState": {},
            "links": [
                {
                    "name": "agent_core",
                    "type": "post"
                }
            ],
            "editRulesInLowCode": false,
            "editRulesInNaturalLanguage": false,
            "rulesCode": "let visibleActions = params.actions\nlet invisibleActions = [name]\nlet visibleStates = params.values\nlet invisibleStates = [name]\n\n\nfunction objectToXML(obj, rootName = 'root', options = {}) {\n  const {\n    indent = '\\t', \n    arrayItemNameOverrides = {\n      board_actions: 'board_action',\n      history: 'message', // ex. <history><message>...</message></history>\n      actions: 'action'\n    },\n    parseJsonStrings = true\n  } = options;\n\n  function escapeXml(str) {\n    return String(str).replace(/[<>&]/g, c => ({\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;'\n    }[c]));\n  }\n\n  function maybeParseJson(value) {\n    if (!parseJsonStrings || typeof value !== 'string') return value;\n    const s = value.trim();\n    if ((s.startsWith('{') && s.endsWith('}')) || (s.startsWith('[') && s.endsWith(']'))) {\n      try { return JSON.parse(s); } catch {  }\n    }\n    return value;\n  }\n\n  function itemTagFor(parentKey) {\n    if (arrayItemNameOverrides && arrayItemNameOverrides[parentKey]) {\n      return arrayItemNameOverrides[parentKey];\n    }\n\n    if (typeof parentKey === 'string') {\n      if (parentKey.endsWith('ies')) return parentKey.slice(0, -3) + 'y';\n      if (parentKey.endsWith('s'))   return parentKey.slice(0, -1);\n    }\n    return 'item';\n  }\n\n  function convert(key, value, level) {\n    value = maybeParseJson(value);\n\n    const pad = indent.repeat(level);\n    const padInner = indent.repeat(level + 1);\n\n    if (value === null || value === undefined) {\n      return `${pad}<${key}></${key}>\\n`;\n    }\n\n    if (Array.isArray(value)) {\n      const itemTag = itemTagFor(key);\n      const children = value.map(item => convert(itemTag, item, level + 1)).join('');\n      return `${pad}<${key}>\\n${children}${pad}</${key}>\\n`;\n    }\n\n    if (typeof value === 'object') {\n      const entries = Object.entries(value);\n      const children = entries.map(([k, v]) => convert(k, v, level + 1)).join('');\n      return `${pad}<${key}>\\n${children}${pad}</${key}>\\n`;\n    }\n\n    return `${pad}<${key}>${escapeXml(value)}</${key}>\\n`;\n  }\n\n  const rootWrapped = convert(rootName, obj, 0);\n  return rootWrapped.trim();\n}\n\nconst filteredActions = boardActions.filter(action => {\n  const name = action.name\n  if (visibleActions.includes('*')) {\n    return !invisibleActions.includes(name)\n  }\n  return visibleActions.includes(name) && !invisibleActions.includes(name)\n}).map(action => {\n  let {html, description, ...rest} = action\n  if(description.startsWith('Actions can perform tasks, automate processes, and enhance user interactions')) {\n    description = 'generic action with no description'\n  }\n  return {\n    description,\n    ...rest\n  }\n})\n\nconst filteredStates = Object.fromEntries(\n  Object.entries(board).filter(([key, value]) => {\n    if (visibleStates.includes('*')) {\n      return !invisibleStates.includes(key)\n    }\n    return visibleStates.includes(key) && !invisibleStates.includes(key)\n  })\n)\n\nconst boardActionsXml = objectToXML(\n  filteredActions,\n  'board_actions',\n  {\n    indent: '\\t',\n    arrayItemNameOverrides: { board_actions: 'board_action', history: 'message' },\n    parseJsonStrings: true\n  }\n)\n\nconst boardStatesXml = objectToXML(\n  filteredStates,\n  'board_states',\n  {\n    indent: '\\t',\n    arrayItemNameOverrides: { history: 'message' },\n    parseJsonStrings: true\n  }\n)\n\nconst promptXml = objectToXML(\n  params.prompt,\n  'prompt',\n  {\n    indent: '\\t',\n    parseJsonStrings: true\n  }\n)\n\nconst message_prompt = params.allow_execution ? `\n<instructions>You are an AI agent inside an AI agent platform called Vento.\nThe agent is managed through a board and the board is composed of states and actions.\nYou will receive a user message and your mission is to generate a json response.\nOnly respond with a JSON in the following format:\n\n{\n    \"response\": \"whatever you want to say\",\n    \"actions\": [\n        {\n            \"name\": \"action_1\",\n            \"params\": {\n                \"example_param\": \"example_value\"\n            } \n        }\n    ]\n}\n\nThe key response will be shown to the user as a response to the user prompt.\nThe actions array can be empty if the user prompt requires no actions to be executed.\nIf the user request an action or an information not available, tell the user there is no card available to perform this action / get this information and suggest the user to extend the board with more cards.\nWhen executing an action, always use the action name. Never use the action id to execute actions, just the name. \n\neach <board_states> entry is a key -> value entry, so: <x>y</x> inside <board_states> means \"the state named x has the value y\"\n\nyour role in the agent platform is to execute actions that could be needed to be executed to answer the user question. Another agent will use the information to generate the response.\nyou should just decide if there is something to execute and execute it.\n</instructions>\n\n${boardActionsXml}\n${boardStatesXml}\n\n\n${promptXml}\n\n` : `\n<instructions>You are an assistant providing answers related to the state of an agent. \nThe agent is managed through a board.\nWhen answering questions or providing information, you need to use the board_states to get the relevant information.\nAnswer in plain language, in the same language the <prompt> is written.\nIf the user request an information not available, tell the user there is no card available to this information and suggest the user to extend the board with more cards.\nif the user asks what do you see, you can tell the user what board_states do you see. Make sure to use the correct state names.\neach <board_states> entry is a key -> value entry, so: <x>y</x> inside <board_states> means \"the state named x has the value y\"\n</instructions>\n\n${boardStatesXml}\n\n${promptXml}\n`\n\nif(params.debug) return message_prompt\nconst response = await context.chatgpt.prompt({\n  message: message_prompt,\n  conversation: await context.chatgpt.getSystemPrompt({\n    prompt: `You can analyze images provided in the same user turn. \nDo NOT claim you cannot see images. \nAnswer following the JSON contract only (no code fences).`,\n  }),\n  images: await context.boards.getStatesByType({\n    board: filteredStates,\n    type: \"frame\",\n    key: \"frame\",\n  }),\n  files: await context.boards.getStatesByType({\n    board: filteredStates,\n    type: \"file\",\n    key: \"path\",\n  }),\n});\nif(params.allow_execution) {\n  return context.chatgpt.processResponse({\n    response: response,\n    execute_action: execute_action,\n  });\n} \nreturn response\n",
            "html": "//@card/react\n\nfunction Widget(card) {\n  const value = card.value;\n\n  const content = <YStack f={1}  mt={\"20px\"} ai=\"center\" jc=\"center\" width=\"100%\">\n      {card.icon && card.displayIcon !== false && (\n          <Icon name={card.icon} size={48} color={card.color}/>\n      )}\n      {card.displayResponse !== false && (\n          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? \"N/A\"} />\n      )}\n  </YStack>\n\n  return (\n      <Tinted>\n        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n          <ActionCard data={card}>\n            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}\n          </ActionCard>\n        </ProtoThemeProvider>\n      </Tinted>\n  );\n}\n"
        },
        {
            "key": "action_1762528985558",
            "width": 3,
            "height": 18,
            "icon": "sparkles",
            "type": "action",
            "name": "agent_core",
            "displayResponse": true,
            "params": {
                "prompt": "",
                "actions": "actions visible for the AI to run",
                "values": "values for the AI to see",
                "allow_execution": "Allow this AI action to execute other actions",
                "debug": "returns back the prompt for debugging purposes"
            },
            "configParams": {
                "prompt": {
                    "visible": true,
                    "defaultValue": "board.user_request",
                    "type": "any"
                },
                "actions": {
                    "visible": true,
                    "defaultValue": "[]",
                    "type": "array"
                },
                "values": {
                    "visible": true,
                    "defaultValue": "[]",
                    "type": "array"
                },
                "allow_execution": {
                    "visible": true,
                    "defaultValue": "false",
                    "type": "boolean"
                },
                "debug": {
                    "visible": true,
                    "defaultValue": "false",
                    "type": "boolean"
                }
            },
            "description": "Execute actions and answer questions using AI.\n\n   #### Key Features\n  - Run actions based on AI.\n  - Chain/trigger other action cards.\n  - Parameterized execution.\n  - Customize parameters.\n  - Customize the card view (UI/render).",
            "displayIcon": false,
            "displayButton": true,
            "displayButtonIcon": true,
            "customName": "agent_core",
            "layer": "agent",
            "color": "var(--color7)",
            "theme": "dark",
            "cardState": {},
            "links": [
                {
                    "name": "reply",
                    "type": "post"
                }
            ],
            "editRulesInLowCode": false,
            "editRulesInNaturalLanguage": false,
            "rulesCode": "let visibleActions = params.actions\nlet invisibleActions = [name]\nlet visibleStates = params.values\nlet invisibleStates = [name]\n\n\nfunction objectToXML(obj, rootName = 'root', options = {}) {\n  const {\n    indent = '\\t', \n    arrayItemNameOverrides = {\n      board_actions: 'board_action',\n      history: 'message', // ex. <history><message>...</message></history>\n      actions: 'action'\n    },\n    parseJsonStrings = true\n  } = options;\n\n  function escapeXml(str) {\n    return String(str).replace(/[<>&]/g, c => ({\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;'\n    }[c]));\n  }\n\n  function maybeParseJson(value) {\n    if (!parseJsonStrings || typeof value !== 'string') return value;\n    const s = value.trim();\n    if ((s.startsWith('{') && s.endsWith('}')) || (s.startsWith('[') && s.endsWith(']'))) {\n      try { return JSON.parse(s); } catch {  }\n    }\n    return value;\n  }\n\n  function itemTagFor(parentKey) {\n    if (arrayItemNameOverrides && arrayItemNameOverrides[parentKey]) {\n      return arrayItemNameOverrides[parentKey];\n    }\n\n    if (typeof parentKey === 'string') {\n      if (parentKey.endsWith('ies')) return parentKey.slice(0, -3) + 'y';\n      if (parentKey.endsWith('s'))   return parentKey.slice(0, -1);\n    }\n    return 'item';\n  }\n\n  function convert(key, value, level) {\n    value = maybeParseJson(value);\n\n    const pad = indent.repeat(level);\n    const padInner = indent.repeat(level + 1);\n\n    if (value === null || value === undefined) {\n      return `${pad}<${key}></${key}>\\n`;\n    }\n\n    if (Array.isArray(value)) {\n      const itemTag = itemTagFor(key);\n      const children = value.map(item => convert(itemTag, item, level + 1)).join('');\n      return `${pad}<${key}>\\n${children}${pad}</${key}>\\n`;\n    }\n\n    if (typeof value === 'object') {\n      const entries = Object.entries(value);\n      const children = entries.map(([k, v]) => convert(k, v, level + 1)).join('');\n      return `${pad}<${key}>\\n${children}${pad}</${key}>\\n`;\n    }\n\n    return `${pad}<${key}>${escapeXml(value)}</${key}>\\n`;\n  }\n\n  const rootWrapped = convert(rootName, obj, 0);\n  return rootWrapped.trim();\n}\n\nconst filteredActions = boardActions.filter(action => {\n  const name = action.name\n  if (visibleActions.includes('*')) {\n    return !invisibleActions.includes(name)\n  }\n  return visibleActions.includes(name) && !invisibleActions.includes(name)\n}).map(action => {\n  let {html, description, ...rest} = action\n  if(description.startsWith('Actions can perform tasks, automate processes, and enhance user interactions')) {\n    description = 'generic action with no description'\n  }\n  return {\n    description,\n    ...rest\n  }\n})\n\nconst filteredStates = Object.fromEntries(\n  Object.entries(board).filter(([key, value]) => {\n    if (visibleStates.includes('*')) {\n      return !invisibleStates.includes(key)\n    }\n    return visibleStates.includes(key) && !invisibleStates.includes(key)\n  })\n)\n\nconst boardActionsXml = objectToXML(\n  filteredActions,\n  'board_actions',\n  {\n    indent: '\\t',\n    arrayItemNameOverrides: { board_actions: 'board_action', history: 'message' },\n    parseJsonStrings: true\n  }\n)\n\nconst boardStatesXml = objectToXML(\n  filteredStates,\n  'board_states',\n  {\n    indent: '\\t',\n    arrayItemNameOverrides: { history: 'message' },\n    parseJsonStrings: true\n  }\n)\n\nconst promptXml = objectToXML(\n  params.prompt,\n  'prompt',\n  {\n    indent: '\\t',\n    parseJsonStrings: true\n  }\n)\n\nconst message_prompt = params.allow_execution ? `\n<instructions>You are an AI agent inside an AI agent platform called Vento.\nThe agent is managed through a board and the board is composed of states and actions.\nYou will receive a user message and your mission is to generate a json response.\nOnly respond with a JSON in the following format:\n\n{\n    \"response\": \"whatever you want to say\",\n    \"actions\": [\n        {\n            \"name\": \"action_1\",\n            \"params\": {\n                \"example_param\": \"example_value\"\n            } \n        }\n    ]\n}\n\nThe key response will be shown to the user as a response to the user prompt.\nThe actions array can be empty if the user prompt requires no actions to be executed.\nIf the user request an action or an information not available, tell the user there is no card available to perform this action / get this information and suggest the user to extend the board with more cards.\nWhen executing an action, always use the action name. Never use the action id to execute actions, just the name. \nWhen answering questions or providing information, you need to use the board_states to get the relevant information.\nif the user asks what do you see, you can tell the user what board_states do you see and what board_actions do you see. make sure to use the ocrrect names for states and actions.\neach <board_states> entry is a key -> value entry, so: <x>y</x> inside <board_states> means \"the state named x has the value y\"\n\n</instructions>\n\n${boardActionsXml}\n${boardStatesXml}\n\n${promptXml}\n` : `\n<instructions>You are an assistant providing answers related to the state of an agent. \nThe agent is managed through a board.\nWhen answering questions or providing information, you need to use the board_states to get the relevant information.\nAnswer in plain language, in the same language the <prompt> is written.\nIf the user request an information not available, tell the user there is no card available to this information and suggest the user to extend the board with more cards.\nif the user asks what do you see, you can tell the user what board_states do you see. Make sure to use the correct state names.\neach <board_states> entry is a key -> value entry, so: <x>y</x> inside <board_states> means \"the state named x has the value y\"\n</instructions>\n<response_format>\nalways answer in plain text, never in json or xml. Just answer what you want to answer and thats it.\n</response_format>\n\n${boardStatesXml}\n\n${promptXml}\n`\n\nif(params.debug) return message_prompt\nconst response = await context.chatgpt.prompt({\n  message: message_prompt,\n  conversation: await context.chatgpt.getSystemPrompt({\n    prompt: `You can analyze images provided in the same user turn. \nDo NOT claim you cannot see images. \nAnswer following the JSON contract only (no code fences).`,\n  }),\n  images: await context.boards.getStatesByType({\n    board: filteredStates,\n    type: \"frame\",\n    key: \"frame\",\n  }),\n  files: await context.boards.getStatesByType({\n    board: filteredStates,\n    type: \"file\",\n    key: \"path\",\n  }),\n});\nif(params.allow_execution) {\n  return context.chatgpt.processResponse({\n    response: response,\n    execute_action: execute_action,\n  });\n} \nreturn response\n",
            "html": "//@card/react\n\nfunction Widget(card) {\n  const value = card.value;\n\n  const content = <YStack f={1}  mt={\"20px\"} ai=\"center\" jc=\"center\" width=\"100%\">\n      {card.icon && card.displayIcon !== false && (\n          <Icon name={card.icon} size={48} color={card.color}/>\n      )}\n      {card.displayResponse !== false && (\n          <CardValue mode={card.markdownDisplay ? 'markdown' : card.htmlDisplay ? 'html' : 'normal'} value={value ?? \"N/A\"} />\n      )}\n  </YStack>\n\n  return (\n      <Tinted>\n        <ProtoThemeProvider forcedTheme={window.TamaguiTheme}>\n          <ActionCard data={card}>\n            {card.displayButton !== false ? <ParamsForm data={card}>{content}</ParamsForm> : card.displayResponse !== false && content}\n          </ActionCard>\n        </ProtoThemeProvider>\n      </Tinted>\n  );\n}\n"
        }
    ],
    "layouts": {
        "lg": [
            {
                "w": 18,
                "h": 22,
                "x": 0,
                "y": 0,
                "i": "action_1760800582118",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 18,
                "h": 5,
                "x": 0,
                "y": 22,
                "i": "action_176081905123123",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 22,
                "h": 3,
                "x": 38,
                "y": 24,
                "i": "action_1761067229271",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 20,
                "h": 7,
                "x": 18,
                "y": 0,
                "i": "action_1761187544907",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 20,
                "h": 20,
                "x": 18,
                "y": 7,
                "i": "action_1762528976758",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 22,
                "h": 24,
                "x": 38,
                "y": 0,
                "i": "action_1762528985558",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            }
        ],
        "md": [
            {
                "w": 18,
                "h": 15,
                "x": 0,
                "y": 0,
                "i": "action_1760800582118",
                "moved": false,
                "static": false,
                "isResizable": true
            },
            {
                "w": 18,
                "h": 7,
                "x": 0,
                "y": 15,
                "i": "action_176081905123123",
                "moved": false,
                "static": false,
                "isResizable": true
            },
            {
                "i": "action_1761067229271",
                "x": 18,
                "y": 21,
                "w": 15,
                "h": 7,
                "isResizable": true
            },
            {
                "i": "action_1761187544907",
                "x": 33,
                "y": 27,
                "w": 15,
                "h": 8,
                "isResizable": true
            },
            {
                "i": "action_1762528976758",
                "x": 0,
                "y": 35,
                "w": 23,
                "h": 14,
                "isResizable": true
            },
            {
                "i": "action_1762528985558",
                "x": 23,
                "y": 48,
                "w": 23,
                "h": 14,
                "isResizable": true
            }
        ],
        "sm": [
            {
                "w": 2,
                "h": 22,
                "x": 0,
                "y": 0,
                "i": "action_1760800582118",
                "moved": false,
                "static": false,
                "isResizable": true
            },
            {
                "w": 2,
                "h": 3,
                "x": 0,
                "y": 22,
                "i": "action_176081905123123",
                "moved": false,
                "static": false,
                "isResizable": true
            },
            {
                "i": "action_1761067229271",
                "x": 0,
                "y": 69,
                "w": 1,
                "h": 7,
                "isResizable": true
            },
            {
                "i": "action_1761187544907",
                "x": 1,
                "y": 75,
                "w": 1,
                "h": 8,
                "isResizable": true
            },
            {
                "i": "action_1762528976758",
                "x": 0,
                "y": 83,
                "w": 2,
                "h": 14,
                "isResizable": true
            },
            {
                "i": "action_1762528985558",
                "x": 0,
                "y": 97,
                "w": 2,
                "h": 14,
                "isResizable": true
            }
        ],
        "xs": [
            {
                "i": "action_1760800582118",
                "x": 0,
                "y": 0,
                "w": 1,
                "h": 22,
                "isResizable": true
            },
            {
                "i": "action_176081905123123",
                "x": 0,
                "y": 63,
                "w": 1,
                "h": 8,
                "isResizable": true
            },
            {
                "i": "action_1761067229271",
                "x": 0,
                "y": 93,
                "w": 1,
                "h": 7,
                "isResizable": true
            },
            {
                "i": "action_1761187544907",
                "x": 0,
                "y": 100,
                "w": 1,
                "h": 8,
                "isResizable": true
            },
            {
                "i": "action_1762528976758",
                "x": 0,
                "y": 108,
                "w": 1,
                "h": 14,
                "isResizable": true
            },
            {
                "i": "action_1762528985558",
                "x": 0,
                "y": 122,
                "w": 1,
                "h": 14,
                "isResizable": true
            }
        ],
        "": [
            {
                "w": 18,
                "h": 15,
                "x": 0,
                "y": 0,
                "i": "action_1760800582118",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 18,
                "h": 7,
                "x": 0,
                "y": 15,
                "i": "action_176081905123123",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 15,
                "h": 7,
                "x": 18,
                "y": 0,
                "i": "action_1761067229271",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 15,
                "h": 8,
                "x": 33,
                "y": 0,
                "i": "action_1761187544907",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 23,
                "h": 14,
                "x": 0,
                "y": 22,
                "i": "action_1762528976758",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            },
            {
                "w": 23,
                "h": 14,
                "x": 23,
                "y": 8,
                "i": "action_1762528985558",
                "moved": false,
                "static": false,
                "isResizable": true,
                "resizeHandles": [
                    "n",
                    "s",
                    "e",
                    "w",
                    "ne",
                    "nw",
                    "se",
                    "sw"
                ]
            }
        ]
    },
    "rules": [
        ""
    ],
    "settings": {
        "autoplay": true
    },
    "icon": "bot",
    "autopilot": false
}